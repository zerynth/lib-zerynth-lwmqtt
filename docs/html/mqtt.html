

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>MQTT &mdash; mqtt 1.0.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/zerynth.css" type="text/css" />
  

  

  
    <link rel="top" title="mqtt 1.0.0 documentation" href="index.html"/>
        <link rel="prev" title="mqtt" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="index.html" class="fa fa-home"> mqtt</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="">MQTT</a></li>
<li class="toctree-l1"><a class="reference internal" href="#mqttmessage-class">MQTTMessage class</a></li>
<li class="toctree-l1"><a class="reference internal" href="#client-class">Client class</a></li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">mqtt</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>MQTT</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="_sources/mqtt.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <span class="target" id="module-mqtt"></span><div class="section" id="mqtt">
<h1>MQTT<a class="headerlink" href="#mqtt" title="Permalink to this headline">¶</a></h1>
<p>This module contains an implementation of the MQTT protocol (client-side) based on the work
of Roger Light &lt;<a class="reference external" href="mailto:roger&#37;&#52;&#48;atchoo&#46;org">roger<span>&#64;</span>atchoo<span>&#46;</span>org</a>&gt; from the <a class="reference external" href="https://eclipse.org/paho/">paho-project</a>.</p>
<p>&#8220;<em>MQTT is a publish-subscribe based lightweight messaging protocol for use on top of the TCP/IP protocol.
[...] The publish-subscribe messaging pattern requires a message broker. The broker is responsible for
distributing messages to interested clients based on the topic of a message.</em>&#8221; (from Wikipedia)</p>
<p>So a client must connect to a broker in order to:</p>
<blockquote>
<div><ul class="simple">
<li><strong>publish</strong> messages specifying a topic so that other clients that have subscribed to that topic
will be able to receive those messages;</li>
<li>receive messages <strong>subscribing</strong> to a specific topic.</li>
</ul>
</div></blockquote>
<p>To clarify this behaviour imagine a home network of temperature sensors and controllers where
each temperature sensor publishes sampled data on &#8216;home/nameOfRoom&#8217; channel and the home
temperature controller subscribes to all channels to achieve a smart heating.</p>
<p>When publishing and subscribing a client is able to specify a quality of service (QoS) level
for messages which activates procedures to assure a message to be actually delivered or
received, available levels are:</p>
<blockquote>
<div><ul class="simple">
<li>0 - at most once</li>
<li>1 - at least once</li>
<li>2 - exactly once</li>
</ul>
</div></blockquote>
<p>Resource clearly explaining the QoS feature:
<a class="reference external" href="http://www.hivemq.com/blog/mqtt-essentials-part-6-mqtt-quality-of-service-levels">mqtt-quality-of-service-levels</a></p>
<p>Back to the implementation Viper mqtt.Client class provides methods to:</p>
<blockquote>
<div><ul class="simple">
<li>connect to a broker</li>
<li>publish</li>
<li>subscribe</li>
<li>unsubscribe</li>
<li>disconnect from the broker</li>
</ul>
</div></blockquote>
<p>and a system of <strong>callbacks</strong> to handle incoming packets.</p>
</div>
<div class="section" id="mqttmessage-class">
<h1>MQTTMessage class<a class="headerlink" href="#mqttmessage-class" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="mqtt.MQTTMessage">
<em class="property">class </em><code class="descname">MQTTMessage</code><a class="headerlink" href="#mqtt.MQTTMessage" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a class that describes an incoming message. It is passed to
callbacks as <em>message</em> field in the <em>data</em> dictionary.</p>
<p>Members:</p>
<ul class="simple">
<li>topic : String. topic that the message was published on.</li>
<li>payload : String. the message payload.</li>
<li>qos : Integer. The message Quality of Service 0, 1 or 2.</li>
<li>retain : Boolean. If true, the message is a retained message and not fresh.</li>
<li>mid : Integer. The message id.</li>
</ul>
</dd></dl>

</div>
<div class="section" id="client-class">
<h1>Client class<a class="headerlink" href="#client-class" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="mqtt.Client">
<em class="property">class </em><code class="descname">Client</code><a class="headerlink" href="#mqtt.Client" title="Permalink to this definition">¶</a></dt>
<dd><p>This is the main module class.
After connecting to a broker it is suggested to subscribe to some channels
and configure callbacks.
Then, a non-blocking loop function, starts a separate thread to handle incoming
packets.</p>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">my_client</span> <span class="o">=</span> <span class="n">mqtt</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="s">&quot;myId&quot;</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">retry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s">&quot;test.mosquitto.org&quot;</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;connecting...&quot;</span><span class="p">)</span>
<span class="n">my_client</span><span class="o">.</span><span class="n">subscribe</span><span class="p">([[</span><span class="s">&quot;cool/channel&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">my_client</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;PUBLISH&quot;</span><span class="p">,</span><span class="n">print_cool_stuff</span><span class="p">,</span><span class="n">is_cool</span><span class="p">)</span>
<span class="n">my_client</span><span class="o">.</span><span class="n">loop</span><span class="p">()</span>

<span class="c"># do something else...</span>
</pre></div>
</div>
<p>Details about the callback system under <code class="xref py py-func docutils literal"><span class="pre">on()</span></code> method.</p>
</dd></dl>

<dl class="method">
<dt id="mqtt.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>client_id</em>, <em>clean_session = True</em><span class="sig-paren">)</span><a class="headerlink" href="#mqtt.__init__" title="Permalink to this definition">¶</a></dt>
<dd><ul class="simple">
<li><em>client_id</em> is the unique client id string used when connecting to the
broker.</li>
<li><em>clean_session</em> is a boolean that determines the client type. If True,
the broker will remove all information about this client when it
disconnects. If False, the client is a persistent client and
subscription information and queued messages will be retained when the
client disconnects.
Note that a client will never discard its own outgoing messages if
accidentally disconnected: calling reconnect() will cause the messages to
be resent.</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="mqtt.on">
<code class="descname">on</code><span class="sig-paren">(</span><em>command</em>, <em>function</em>, <em>condition = None</em>, <em>priority = 0</em><span class="sig-paren">)</span><a class="headerlink" href="#mqtt.on" title="Permalink to this definition">¶</a></dt>
<dd><ul>
<li><p class="first"><em>command</em> is a string referring to which MQTT command call the callback on.</p>
</li>
<li><p class="first"><em>function</em> is the function to execute if <em>condition</em> is respected.
It takes both the client itself and a <em>data</em> dictionary as parameters.
The <em>data</em> dictionary may contain the following fields:</p>
<blockquote>
<div><ul class="simple">
<li><em>message</em>: MQTTMessage present only on PUBLISH packets for messages
with qos equal to 0 or 1, or on PUBREL packets for messages with
qos equal to 2</li>
</ul>
</div></blockquote>
</li>
<li><p class="first"><em>condition</em> is a function taking the same <em>data</em> dictionary as parameter
and returning True or False if the packet respects a certain condition.
<em>condition</em> parameter is optional because a generic callback can be set without
specifying a condition, only in response to a command.
A callback of this type is called a &#8216;low priority&#8217; callback meaning that it
is called only if all the more specific callbacks (the ones with condition)
get a False condition response.</p>
<blockquote>
<div><p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">is_cool</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="s">&#39;message&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;message&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">topic</span> <span class="o">==</span> <span class="s">&quot;cool&quot;</span><span class="p">)</span>
    <span class="c"># N.B. not checking if &#39;message&#39; is in data could lead to Exception</span>
    <span class="c"># on PUBLISH packets for messages with qos equal to 2</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">print_cool_stuff</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&quot;cool: &quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;message&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">print_generic_stuff</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="s">&#39;message&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;not cool: &quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;message&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>

<span class="n">my_client</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;PUBLISH&quot;</span><span class="p">,</span> <span class="n">print_cool_stuff</span><span class="p">,</span> <span class="n">is_cool</span><span class="p">)</span>
<span class="n">my_client</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="s">&quot;PUBLISH&quot;</span><span class="p">,</span> <span class="n">print_generic_stuff</span><span class="p">)</span>
</pre></div>
</div>
<p>In the above example for every PUBLISH packet it is checked if the topic
is <em>cool</em>, only if this condition fails, <em>print_generic_stuff</em> gets executed.</p>
</div></blockquote>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="mqtt.connect">
<code class="descname">connect</code><span class="sig-paren">(</span><em>host</em>, <em>keepalive</em>, <em>port = 1883</em><span class="sig-paren">)</span><a class="headerlink" href="#mqtt.connect" title="Permalink to this definition">¶</a></dt>
<dd><p>Connect to a remote broker.</p>
<ul class="simple">
<li><em>host</em> is the hostname or IP address of the remote broker.</li>
<li><em>port</em> is the network port of the server host to connect to. Defaults to
1883.</li>
<li><em>keepalive</em> is the maximum period in seconds between communications with the
broker. If no other messages are being exchanged, this controls the
rate at which the client will send ping messages to the broker.</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="mqtt.reconnect">
<code class="descname">reconnect</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mqtt.reconnect" title="Permalink to this definition">¶</a></dt>
<dd><p>Reconnect the client if accidentally disconnected.</p>
</dd></dl>

<dl class="method">
<dt id="mqtt.subscribe">
<code class="descname">subscribe</code><span class="sig-paren">(</span><em>topics</em><span class="sig-paren">)</span><a class="headerlink" href="#mqtt.subscribe" title="Permalink to this definition">¶</a></dt>
<dd><p>Subscribe to one or more topics.</p>
<ul>
<li><p class="first"><em>topis</em> a list structured this way:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[[</span><span class="n">topic1</span><span class="p">,</span><span class="n">qos1</span><span class="p">],[</span><span class="n">topic2</span><span class="p">,</span><span class="n">qos2</span><span class="p">],</span><span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
<p>where topic1,topic2,... are strings and qos1,qos2,... are integers for
the maximum quality of service for each topic</p>
</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="mqtt.unsubscribe">
<code class="descname">unsubscribe</code><span class="sig-paren">(</span><em>topics</em><span class="sig-paren">)</span><a class="headerlink" href="#mqtt.unsubscribe" title="Permalink to this definition">¶</a></dt>
<dd><p>Unsubscribe the client from one or more topics.</p>
<ul class="simple">
<li><em>topics</em> is list of strings that are subscribed topics to unsubscribe from.</li>
</ul>
</dd></dl>

<dl class="method">
<dt id="mqtt.publish">
<code class="descname">publish</code><span class="sig-paren">(</span><em>topic</em>, <em>payload = None</em>, <em>qos = 0</em>, <em>retain = False</em><span class="sig-paren">)</span><a class="headerlink" href="#mqtt.publish" title="Permalink to this definition">¶</a></dt>
<dd><p>Publish a message on a topic.</p>
<p>This causes a message to be sent to the broker and subsequently from
the broker to any clients subscribing to matching topics.</p>
<ul class="simple">
<li><em>topic</em> is the topic that the message should be published on.</li>
<li><em>payload</em> is the actual message to send. If not given, or set to None a
zero length message will be used.</li>
<li><em>qos</em> is the quality of service level to use.</li>
<li><em>retain</em>: if set to true, the message will be set as the &#8220;last known
good&#8221;/retained message for the topic.</li>
</ul>
<p>It returns the mid generated for the message to give the possibility to
set a callback precisely for that message.</p>
</dd></dl>

<dl class="method">
<dt>
<code class="descname">reconnect</code><span class="sig-paren">(</span><span class="sig-paren">)</span></dt>
<dd><p>Send a disconnect message.</p>
</dd></dl>

<dl class="method">
<dt id="mqtt.loop">
<code class="descname">loop</code><span class="sig-paren">(</span><em>on_message = None</em><span class="sig-paren">)</span><a class="headerlink" href="#mqtt.loop" title="Permalink to this definition">¶</a></dt>
<dd><p>Non blocking loop method that starts a thread to handle incoming packets.</p>
<ul class="simple">
<li><em>on_message</em> is an optional argument to set a generic callback on messages
with qos equal to 0, 1 or 2</li>
</ul>
</dd></dl>

</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="index.html" class="btn btn-neutral" title="mqtt"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Zerynth Team.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
 <script type="text/javascript">
 var vurl
 if(location.href.indexOf("127.0.0.1")>=0) vurl=location.protocol+"//"+location.host+"/docs"
 else vurl="http://doc.zerynth.com"
 $(document).ready(function(){
                   $('.wy-breadcrumbs a:contains("Docs")').before('<a href="'+vurl+'">Zerynth</a> &#187;')
                   $('.wy-side-nav-search > a').removeClass("fa-home").removeClass("fa")
                   $('.wy-side-nav-search').prepend('<div class="viper-circle"><a href="'+vurl+'"><span style="color:#1c5e60" class="zerynth-Logo2"></span></a></div>')
 })
 </script>


</body>
</html>